<!doctype html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>מחשבון שעות</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600;800&family=Heebo:wght@300;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: dark;
        --bg: #090c0a;
        --bg-2: #0d1411;
        --panel: #0f1914;
        --panel-2: #141f18;
        --text: #e8ffe9;
        --muted: #9cc9a6;
        --green: #35ff6b;
        --green-2: #19cc59;
        --border: #1d3a2a;
        --shadow: 0 18px 60px rgba(3, 25, 12, 0.65);
        --danger: #ff6b6b;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Rubik", "Heebo", sans-serif;
        background: radial-gradient(circle at 15% 20%, #17301f 0%, transparent 55%),
          radial-gradient(circle at 80% 10%, #0d2416 0%, transparent 45%),
          linear-gradient(160deg, var(--bg), var(--bg-2));
        color: var(--text);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 32px 18px 48px;
      }

      .app {
        width: min(880px, 96vw);
      }

      .header {
        text-align: center;
        margin-bottom: 24px;
      }

      .header h1 {
        font-size: clamp(2rem, 2.8vw, 2.7rem);
        margin: 0;
        color: var(--text);
        letter-spacing: 0.04em;
      }

      .header p {
        margin: 8px 0 0;
        color: var(--muted);
        font-weight: 300;
      }

      .panel {
        background: linear-gradient(160deg, var(--panel), var(--panel-2));
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 28px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(8px);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 18px;
        margin-bottom: 20px;
      }

      .field {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .label {
        font-size: 0.95rem;
        color: var(--muted);
      }

      .input {
        width: 100%;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid #23412f;
        background: #0b1410;
        color: var(--text);
        font-size: 1rem;
        outline: none;
        transition: border 0.2s ease, box-shadow 0.2s ease;
      }

      .input:focus {
        border-color: var(--green);
        box-shadow: 0 0 0 2px rgba(53, 255, 107, 0.2);
      }

      .helper {
        font-size: 0.85rem;
        color: var(--muted);
      }

      .result {
        font-size: 1.15rem;
        padding: 14px 16px;
        border-radius: 14px;
        background: rgba(10, 24, 16, 0.7);
        border: 1px solid #1d3a2a;
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 18px;
      }

      .result strong {
        color: var(--green);
        font-size: 1.35rem;
      }

      .result.error {
        border-color: rgba(255, 107, 107, 0.4);
        color: #ffd7d7;
      }

      .result.error strong {
        color: var(--danger);
      }

      .actions {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
        margin-bottom: 16px;
      }

      .glow-button {
        background: linear-gradient(135deg, #1edb5f, #4bff85);
        color: #05140a;
        border: none;
        padding: 12px 28px;
        font-size: 1.05rem;
        font-weight: 700;
        border-radius: 999px;
        cursor: pointer;
        box-shadow: 0 0 18px rgba(53, 255, 107, 0.45), 0 8px 30px rgba(11, 56, 22, 0.7);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .glow-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 0 24px rgba(53, 255, 107, 0.7), 0 10px 34px rgba(11, 56, 22, 0.85);
      }

      .glow-button:disabled {
        cursor: not-allowed;
        opacity: 0.55;
        box-shadow: none;
      }

      .copy-output {
        background: #0c1712;
        border: 1px solid #1f3b2c;
        border-radius: 16px;
        padding: 18px;
        white-space: pre-line;
        font-size: 0.98rem;
        color: #d8ffe3;
      }

      .copy-title {
        margin: 0 0 8px;
        font-weight: 600;
        color: var(--muted);
      }

      .toast {
        position: fixed;
        left: 50%;
        bottom: 28px;
        transform: translateX(-50%) translateY(20px);
        background: #0f1e15;
        border: 1px solid #2b5a3a;
        color: var(--text);
        padding: 10px 18px;
        border-radius: 999px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease, transform 0.3s ease;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        z-index: 20;
      }

      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      @media (max-width: 560px) {
        .panel {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <main class="app">
      <header class="header">
        <h1>מחשבון שעות</h1>
        <p>מחשבים כמה נשאר לסיים את היעד בזמן אמת.</p>
      </header>

      <section class="panel">
        <div class="grid">
          <label class="field">
            <span class="label">כמה שעות צריך</span>
            <input
              id="requiredInput"
              class="input"
              type="text"
              inputmode="decimal"
              placeholder="לדוגמה: 7.5 או 7:30"
              autocomplete="off"
            />
            <span class="helper">אפשר להזין שעות עשרוניות או בפורמט שעה:דקה.</span>
          </label>

          <label class="field">
            <span class="label">כמה שעות עשיתי עד עכשיו</span>
            <input
              id="completedInput"
              class="input"
              type="text"
              inputmode="decimal"
              placeholder="לדוגמה: 3 או 2:15"
              autocomplete="off"
            />
            <span class="helper">לדוגמה: 2.25 = שעתיים ורבע.</span>
          </label>
        </div>

        <div class="result" id="resultBox">
          <span>כמה נשאר לי:</span>
          <strong id="resultValue">—</strong>
        </div>

        <div class="actions">
          <button class="glow-button" id="copyButton" disabled>העתק פורמט</button>
        </div>

        <div class="copy-title">טקסט מוכן להעתקה</div>
        <pre class="copy-output" id="formatOutput"></pre>
      </section>
    </main>

    <div id="toast" class="toast" role="status" aria-live="polite">הועתק! הטקסט הועתק ללוח</div>

    <script>
      const requiredInput = document.getElementById("requiredInput");
      const completedInput = document.getElementById("completedInput");
      const resultBox = document.getElementById("resultBox");
      const resultValue = document.getElementById("resultValue");
      const copyButton = document.getElementById("copyButton");
      const formatOutput = document.getElementById("formatOutput");
      const toast = document.getElementById("toast");

            const sanitizeInput = (value) =>
        value.replace(/[\u200e\u200f\u202a-\u202e]/g, "").trim();

      const parseHebrewTimeToMinutes = (rawValue) => {
        const normalized = rawValue
          .replace(/,/g, " ")
          .replace(/\s+/g, " ")
          .trim();

        if (!normalized) {
          return null;
        }

        const unitRegex = /(\d+(?:[.,]\d+)?)\s*(שעה|שעות|דק(?:ה|ות))/g;
        const toNumber = (value) => Number(value.replace(",", "."));

        let hoursTotal = 0;
        let minutesTotal = 0;
        let matched = false;
        let match;

        while ((match = unitRegex.exec(normalized)) !== null) {
          matched = true;
          const amount = toNumber(match[1]);
          if (!Number.isFinite(amount) || amount < 0) {
            return null;
          }

          const unit = match[2];
          if (unit === "שעה" || unit === "שעות") {
            hoursTotal += amount;
          } else {
            minutesTotal += amount;
          }
        }

        if (!matched) {
          return null;
        }

        return Math.round(hoursTotal * 60 + minutesTotal);
      };

      const parseTimeToMinutes = (value) => {
        const raw = sanitizeInput(value);
        if (!raw) {
          return null;
        }

        const hhmmMatch = raw.match(/^(\d+)\s*:\s*(\d{1,2})$/);
        if (hhmmMatch) {
          const hours = Number(hhmmMatch[1]);
          const minutes = Number(hhmmMatch[2]);
          if (!Number.isFinite(hours) || !Number.isFinite(minutes)) {
            return null;
          }
          if (hours < 0 || minutes < 0 || minutes >= 60) {
            return null;
          }
          return Math.round(hours * 60 + minutes);
        }

        const hebrewMinutes = parseHebrewTimeToMinutes(raw);
        if (hebrewMinutes !== null) {
          return hebrewMinutes;
        }

        const decimalNormalized = raw.replace(/,/g, ".");
        if (!/^\d+(?:\.\d+)?$/.test(decimalNormalized)) {
          return null;
        }
        const hours = Number(decimalNormalized);
        if (!Number.isFinite(hours) || hours < 0) {
          return null;
        }
        return Math.round(hours * 60);
      };

      /*
        Examples:
        parseTimeToMinutes("15") === 900
        parseTimeToMinutes("7.5") === 450
        parseTimeToMinutes("7:30") === 450
        parseTimeToMinutes("6 שעות, 51 דקות") === 411
        calculateRemainingMinutes(900, parseTimeToMinutes("6 שעות, 51 דקות")) === 489
      */

      const calculateRemainingMinutes = (requiredMinutes, completedMinutes) => {
        return requiredMinutes - completedMinutes;
      };

      const formatMinutesHebrew = (minutes) => {
        const total = Math.abs(minutes);
        const hours = Math.floor(total / 60);
        const mins = total % 60;
        return `${hours} שעות ו-${mins} דקות`;
      };

      const buildResultInfo = (remainingMinutes) => {
        if (remainingMinutes === 0) {
          return { display: "סיימת את היעד", copy: "סיימת את היעד" };
        }
        if (remainingMinutes < 0) {
          const overText = `עברת את היעד ב-${formatMinutesHebrew(remainingMinutes)}`;
          return { display: overText, copy: overText };
        }
        const remainingText = formatMinutesHebrew(remainingMinutes);
        return { display: remainingText, copy: remainingText };
      };

      const buildCopyText = (requiredRaw, completedRaw, resultText) => {
        return `פורמט שעות\nכמה שעות צריך: ${requiredRaw}\nכמה שעות עשיתי עד עכשיו: ${completedRaw}\nכמה נשאר לי: ${resultText}`;
      };

      const setResult = (text, isError) => {
        resultValue.textContent = text;
        resultBox.classList.toggle("error", isError);
      };

      const showToast = () => {
        toast.classList.add("show");
        clearTimeout(showToast.timeoutId);
        showToast.timeoutId = setTimeout(() => {
          toast.classList.remove("show");
        }, 2200);
      };

      const updateOutput = () => {
        const requiredRaw = requiredInput.value.trim();
        const completedRaw = completedInput.value.trim();

        if (!requiredRaw && !completedRaw) {
          setResult("—", false);
          formatOutput.textContent = "";
          copyButton.disabled = true;
          return;
        }

        if (!requiredRaw || !completedRaw) {
          setResult("נא למלא את שני השדות", true);
          formatOutput.textContent = "";
          copyButton.disabled = true;
          return;
        }

        const requiredMinutes = parseTimeToMinutes(requiredRaw);
        const completedMinutes = parseTimeToMinutes(completedRaw);

        if (requiredMinutes === null || completedMinutes === null) {
          setResult("קלט לא תקין. השתמשו בפורמט 7.5, 7:30 או 6 שעות 51 דקות", true);
          formatOutput.textContent = "";
          copyButton.disabled = true;
          return;
        }

        const remainingMinutes = calculateRemainingMinutes(requiredMinutes, completedMinutes);
        const resultInfo = buildResultInfo(remainingMinutes);

        setResult(resultInfo.display, false);
        formatOutput.textContent = buildCopyText(requiredRaw, completedRaw, resultInfo.copy);
        copyButton.disabled = false;
      };

      const copyToClipboard = async () => {
        if (copyButton.disabled) {
          return;
        }
        const text = formatOutput.textContent;
        try {
          await navigator.clipboard.writeText(text);
          showToast();
        } catch (error) {
          const temp = document.createElement("textarea");
          temp.value = text;
          temp.style.position = "fixed";
          temp.style.left = "-9999px";
          document.body.appendChild(temp);
          temp.select();
          document.execCommand("copy");
          document.body.removeChild(temp);
          showToast();
        }
      };

      requiredInput.addEventListener("input", updateOutput);
      completedInput.addEventListener("input", updateOutput);
      copyButton.addEventListener("click", copyToClipboard);

      updateOutput();
    </script>
  </body>
</html>




